!function(t){"use strict";function e(t){t||(t="transform");var e=document.defaultView.getComputedStyle(document.body,"");return e[t]?"":e["-webkit-"+t]?"-webkit-":e["-moz-"+t]?"-moz-":e["-o-"+t]?"-o-":e["-khtml-"+t]?"-khtml-":!1}var i=e(),s=function(e,i){this.$el=t(e),this.el=e[0],this._create(i)};s.defaultClass="waterfall",t.extend(s.prototype,{options:{colMinWidth:300,defaultContainerWidth:window.clientWidth,autoresize:!0,maxCols:16,updateDelay:45,useCalc:void 0,useTranslate3d:void 0,animateShow:!1,reflow:null},_create:function(e){var s=this,l=s.options=t.extend({},s.options,e);this.items=[],s.lastHeights=[],s.lastItems=[],s.colPriority=[],s.baseOrder=[];var a=getComputedStyle(s.el);s.el.hidden=!0,s.el.style.minHeight=a.height,"static"===s.$el.css("position")&&(s.el.style.position="relative"),void 0===l.useCalc&&(this.prefixedCalc=function(){for(var t=document.createElement("div"),e=["calc","-webkit-calc","-moz-calc","-o-calc"],s=0;s<e.length;++s){var l=e[s],a=l+"(1px)";if(t.style.cssText=i+"transform: translate3d("+[a,a,a].join(",")+");",t.style.length&&t.style[i+"transform"].length>14)return l}}(),l.useCalc=!!this.prefixedCalc),void 0===l.useTranslate3d&&(this.prefixedTranslate3d=function(){for(var t=document.createElement("div"),e=["translate3d","-webkit-translate3d","-moz-translate3d","-o-translate3d"],s=0;s<e.length;++s){var l=e[s];if(t.style.cssText=i+"transform:"+l+"(1px, 0, 0);",t.style.length)return l}}(),l.useTranslate3d=!!this.prefixedTranslate3d);var n;n=s.$el.children();for(var o=0;o<s.el.childNodes.length;)1!==s.el.childNodes[o].nodeType&&8!==s.el.childNodes[o].nodeType?s.el.removeChild(s.el.childNodes[o]):o++;n.each(function(t,e){s._addItem(e),s._initItem(e)}),s.lastItem=s.items[s.items.length-1],s.el.removeAttribute("hidden"),s._update(),l.autoresize&&t(window).resize(s.reflow.bind(s)),this._observeMutations()},_addItem:function(t){t.getAttribute("data-exclude")||this.items.push(t)},_observeMutations:function(){window.MutationObserver?(this.observer=new MutationObserver(function(t){for(var e=t.length,i=0;e>i;i++)if(t[i].removedNodes.length&&this._removedItems(Array.prototype.slice.apply(t[i].removedNodes)),t[i].addedNodes.length){var s=Array.prototype.slice.apply(t[i].addedNodes);t[i].nextSibling?this._insertedItems(s):this._appendedItems(s)}}.bind(this)),this.observer.observe(this.el,{attributes:!1,childList:!0,characterData:!1})):this.$el.on("DOMNodeInserted",function(t){var e=t.originalEvent||t,i=e.target;1!==i.nodeType&&8!==i.nodeType||i.parentNode===this.el&&(!i.previousSibling||!i.previousSibling.span||i.nextSibling&&i.nextSibling.span?this._insertedItems([i]):this._appendedItems([i]))}.bind(this)).on("DOMNodeRemoved",function(t){var e=(t.originalEvent||t).target;1!==e.nodeType&&8!==e.nodeType||e.parentNode===this.el&&this._removedItems([e])}.bind(this))},reflow:function(){var t=this,e=t.options;return window.clearTimeout(t._updateInterval),t._updateInterval=window.setTimeout(t._update.bind(t),e.updateDelay),t},_appendedItems:function(t){for(var e=t.length,i=0;e>i;i++){var s=t[i];1===s.nodeType&&(this._addItem(s),this._initItem(s),this._setItemWidth(s))}for(i=0;e>i;i++)1===t[i].nodeType&&this._placeItem(t[i]);this.lastItem=this.items[this.items.length-1],this._maximizeHeight()},_insertedItems:function(t){this.items.length=0;for(var e=t.length,i=0;e>i;i++){var s=t[i];1!==s.nodeType&&8!==s.nodeType||(this._initItem(s),this._setItemWidth(s))}for(var l=this.el.childNodes,a=l.length,i=0;a>i;i++)1!==l[i].nodeType&&8!==s.nodeType||l[i].span&&this._addItem(l[i]);this.lastItem=this.items[this.items.length-1],this.reflow()},_removedItems:function(t){for(var e=this.el.childNodes,i=(e.length,0);i<t.length;i++)this.items.splice(this.items.indexOf(t[i]),1);this.lastItem=this.items[this.items.length-1],this.reflow()},_trigger:function(t,e){try{this.options[t]&&this.options[t].call(this.$el,e),this.$el.trigger(t,[e])}catch(i){throw i}},_initItem:function(t){var e=this.options,i=t.getAttribute("data-span")||1,s=t.getAttribute("data-float")||t.getAttribute("data-column");i="all"===i?e.maxCols:Math.max(0,Math.min(~~i,e.maxCols)),t.span=i;var l=getComputedStyle(t);switch(t.mr=~~l.marginRight.slice(0,-2),t.ml=~~l.marginLeft.slice(0,-2),t.bt=~~l.borderTopWidth.slice(0,-2),t.bb=~~l.borderBottomWidth.slice(0,-2),t.mt=~~l.marginTop.slice(0,-2),t.mb=~~l.marginBottom.slice(0,-2),t.style.position="absolute",s){case null:t.floatCol=null;break;case"right":case"last":t.floatCol=-i;break;case"left":case"first":t.floatCol=0;break;default:t.floatCol=~~s-1}e.animateShow&&(e.useTranslate3d||(t.style.top=this.lastHeights[this.colPriority[this.colPriority.length-1]]+"px",t.style.left=this.colWidth*this.colPriority[this.colPriority.length-1]+"px"),t.removeAttribute("hidden"))},_initLayoutParams:function(){var t=this,e=t.options,i=window.getComputedStyle(t.el),s=0,l=t.lastItems.length;t.pl=~~i.paddingLeft.slice(0,-2),t.pt=~~i.paddingTop.slice(0,-2),t.pr=~~i.paddingRight.slice(0,-2),t.pb=~~i.paddingBottom.slice(0,-2),t.lastHeights.length=0,t.colPriority.length=0,t.baseOrder.length=0,t.colWidth=t.el.offsetWidth-t.pl-t.pr,t.lastItems.length=~~(t.colWidth/e.colMinWidth)||1;var a=e.useTranslate3d?0:t.pt;for(s=0;s<t.lastItems.length;s++)t.lastHeights.push(a),t.baseOrder.push(s),t.colPriority.push(s);if(t.colWidth/=t.lastItems.length,!e.useCalc||l!==t.lastItems.length)for(s=t.items.length;s--;)this._setItemWidth(t.items[s]);return t.lastItems.length},_updateInterval:0,_update:function(t,e){var i=this,s=0,l=t||0,a=e||i.items.length;i._initLayoutParams();for(s=l;a>s;s++)i._placeItem(i.items[s]);i._maximizeHeight(),i._trigger("reflow")},_setItemWidth:function(t){var e=t.span>this.lastItems.length?this.lastItems.length:t.span,i=this.lastItems.length,s=e/i;this.options.useCalc?(t.w=100*s,t.style.width=this.prefixedCalc+"("+100*s+"% - "+(t.mr+t.ml+(this.pl+this.pr)*s)+"px)"):(t.w=~~(this.colWidth*e-(t.ml+t.mr)),t.style.width=t.w+"px")},_placeItem:function(t){var e=this,s=e.options,l=e.lastHeights,a=e.lastItems,n=e.colPriority,o=0,r=0,h=0,d=0,p=0,m=t.span>a.length?a.length:t.span,c=0,f=[],u=[],g=t.floatCol;if(g&&(g=g>0?Math.min(g,a.length-m):a.length+g),1===m){if(null===g)o=n.shift();else for(o=g,d=0;d<n.length;d++)if(n[d]==o){n.splice(d,1);break}f.push(o),r=l[o]}else if(m>=a.length)o=0,r=l[n[n.length-1]],f=e.baseOrder.slice(),f.length=l.length,n.length=0;else{if(null!==g)o=g,r=Math.max.apply(Math,l.slice(o,o+m));else for(u.length=0,r=1/0,o=0,d=0;d<=a.length-m;d++)u[d]=Math.max.apply(Math,l.slice(d,d+m)),u[d]<r&&(o=d,r=u[d]);for(d=0;d<n.length;)n[d]>=o&&n[d]<o+m?f.push(n.splice(d,1)[0]):d++}if(t.top=~~r,s.useTranslate3d){var y=100*o/m+"% + "+~~((t.ml+t.mr)*o/m)+"px";s.useCalc?t.style[i+"transform"]=this.prefixedTranslate3d+"( "+this.prefixedCalc+"("+y+"), "+t.top+"px, 0)":t.style[i+"transform"]=this.prefixedTranslate3d+"("+~~(e.colWidth*o)+"px, "+t.top+"px, 0)"}else t.style.top=t.top+"px",t.style.left=e.colWidth*o+e.pl+"px";for(t.removeAttribute("hidden"),c=e._getBottom(t),p=0;p<f.length;p++)a[f[p]]=t,e.lastHeights[f[p]]=c;for(d=n.length;d--;)if(h=e.lastHeights[n[d]],c>=h){Array.prototype.splice.apply(n,[d+1,0].concat(f));break}n.length<l.length&&Array.prototype.unshift.apply(n,f)},_getBottom:function(t){return t?t.top+t.offsetHeight+t.bt+t.bb+t.mb+t.mt:0},_maximizeHeight:function(){var t=this.options.useTranslate3d?this.pt:0;this.el.style.minHeight=this.lastHeights[this.colPriority[this.colPriority.length-1]]+this.pb+t+"px"}}),t.fn.waterfall=function(e,i){if("string"==typeof e)return t(this).each(function(s,l){t(l).data("waterfall")[e](i)});if(!this.length)throw new Error("No element passed to waterfall");var l=t(this),a=t.extend({},{colMinWidth:~~l[0].getAttribute("data-col-min-width")||~~l[0].getAttribute("data-width")},e);a.width&&!a.colMinWidth&&(a.colMinWidth=a.width);var n=new s(l,a);return l.data("waterfall")||l.data("waterfall",n),n},t(function(){var e=window.waterfall&&window.waterfall.defaultClass||s.defaultClass;t("."+e).each(function(e,i){var s=t(i),l=window.waterfall||{};s.waterfall(l)})})}(window.jQuery||window.Zepto);